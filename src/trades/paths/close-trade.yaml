put:
  summary: Close Trade
  description: Close (partially or fully) a specific open Trade in an Account
  tags:
    - Trade
  parameters:
    - $ref: ../../shared/parameters/AccountID.yaml
    - $ref: ../../shared/parameters/AcceptDatetimeFormat.yaml
    - $ref: ../../shared/parameters/TradeSpecifier.yaml
  requestBody:
    description: Details of how much of the open Trade to close.
    required: true
    content:
      application/json:
        schema:
          type: object
          properties:
            units:
              type: string # TODO: regex for ALL or decimal
              description: Indication of how much of the Trade to close. Either the string "ALL" (indicating that all of the Trade should be closed), or a DecimalNumber representing the number of unitsof the open Trade to Close using a TradeClose MarketOrder. The units specified must always be positive, and the magnitude of the value cannot exceed the magnitude of the Trade's open units.
  responses:
    200:
      description: The Trade has been closed as requested
      headers:
        RequestID:
          $ref: ../../shared/headers/RequestID.yaml
      content:
        application/json:
          schema:
            allOf:
              - type: object
                properties:
                  orderCreateTransaction:
                    $ref: ../../transactions/types/order/market/MarketOrderTransaction.yaml
                  orderFillTransaction:
                    $ref: ../../transactions/types/order/fill/OrderFillTransaction.yaml
                  orderCancelTransaction:
                    $ref: ../../transactions/types/order/cancel/OrderCancelTransaction.yaml
              - $ref: ../../transactions/types/shared/RelatedTransactions.yaml
    400:
      description: The Trade cannot be closed as requested.
      headers:
        RequestID:
          $ref: ../../shared/headers/RequestID.yaml
      content:
        application/json:
          schema:
            allOf:
              - type: object
                properties:
                  orderRejectTransaction:
                    $ref: ../../transactions/types/order/market/MarketOrderRejectTransaction.yaml
              - $ref: ../../shared/errors/helpers/4xxTransactionError.yaml
    401:
      $ref: ../../shared/errors/401.yaml
    404:
      description: The Account or Trade specified does not exist.
      headers:
        RequestID:
          $ref: ../../shared/headers/RequestID.yaml
      content:
        application/json:
          schema:
            allOf:
              - type: object
                properties:
                  orderRejectTransaction:
                    $ref: ../../transactions/types/order/market/MarketOrderRejectTransaction.yaml
              - $ref: ../../shared/errors/helpers/4xxTransactionError.yaml  
    405:
      $ref: ../../shared/errors/405.yaml